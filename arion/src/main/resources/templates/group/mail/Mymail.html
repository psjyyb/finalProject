<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{common/group/layouts/group_layout}"
	layout:fragment="Content">
<head>
<title>받은 메일함</title>
<style>
/* 기존 스타일 유지 */
h1 { /* 스타일 정의 */
	
}

table { /* 스타일 정의 */
	
}

th, td { /* 스타일 정의 */
	
}

th { /* 스타일 정의 */
	
}

tr:nth-child(even) { /* 스타일 정의 */
	
}

.checkbox-container { /* 스타일 정의 */
	
}

.compose-btn, .delete-btn { /* 스타일 정의 */
	
}

.actions-container { /* 스타일 정의 */
	
}

.actions-container label { /* 스타일 정의 */
	
}
</style>
</head>
<body>
	<h1>받은 메일함</h1>

	<table>
		<thead>
			<tr>
				<th class="checkbox-container"><input type="checkbox"
					id="selectAll"> <!-- 전체 선택 체크박스 --></th>
				<th>보낸사람</th>
				<th>제목</th>
				<th>수신일</th>
			</tr>
		</thead>
		<tbody>
			<tr th:each="mail : ${receivedMails}">
				<td class="checkbox-container"><input type="checkbox"
					name="mailIds" value="${mail.mailNo}"> <!-- 각 메일의 ID를 값으로 설정 -->
				</td>
				<td th:text="${mail.senderName}">발송자 이름</td>
				<td><a
					th:href="@{/group/mail/detailmail/{mailNo}/{employeeId}(mailNo=${mail.mailNo}, employeeId=${employeeId})}"
					th:text="${mail.mailTitle}">메일 제목</a></td>
				<td th:text="${#dates.format(mail.sendDate, 'yyyy-MM-dd')}">발송일</td>
			</tr>
		</tbody>
	</table>
	<div class="actions-container">
		<button id="importSelected">중요메일함</button>
		<button id="deleteSelected">휴지통</button>
	</div>

	<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
	<script>
        document.getElementById('selectAll').addEventListener('change', function() {
            const isChecked = this.checked;
            const checkboxes = document.querySelectorAll('input[name="mailIds"]');
            checkboxes.forEach(checkbox => {
                checkbox.checked = isChecked;
            });
        });

        document.getElementById('deleteSelected').addEventListener('click', function() {
            const checkboxes = document.querySelectorAll('input[name="mailIds"]:checked');
            if (checkboxes.length > 0) {
                if (confirm('선택한 메일을 삭제하시겠습니까?')) {
                    const ids = Array.from(checkboxes).map(checkbox => checkbox.value);

                    axios.post('/group/deleteMails', { ids: ids })
                        .then(response => {
                            if (response.data.status === 'success') {
                                alert('메일이 삭제되었습니다.');
                                window.location.reload(); // 페이지 새로 고침
                            } else {
                                alert('메일 삭제에 실패하였습니다.');
                            }
                        })
                        .catch(error => {
                            console.error('삭제 요청 실패:', error);
                            alert('메일 삭제 요청 중 오류가 발생했습니다.');
                        });
                }
            } else {
                alert('삭제할 메일을 선택하세요.');
            }
        });
    </script>
</body>
</html>

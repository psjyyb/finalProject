<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{common/group/layouts/group_layout}"
	layout:fragment="Content">
<head>
<meta charset="UTF-8">
<link rel="stylesheet" th:href="@{/smarteditor2/css/smart_editor2_items.css}">
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<link rel="stylesheet" th:href="@{/css/group/board/reply.css}">
<title></title>
</head>
<body>
	<div>
		<h3><a th:href="@{/group/freeboardList}">자유게시판</a></h3>
		
		<table>
			<tr>
				<th>번호</th>
				<td th:text="${board.boardNo}"></td>
			</tr>
			<tr>
				<th>제목</th>
				<td>[[${board.boardTitle}]]</td>
			</tr>
			<tr>
				<th>작성자</th>
				<td>[[${board.employeeName}]]</td>
			</tr>
			<tr>
				<th>내용</th>
				<td style="height:300px; width:500px;" th:utext="${board.boardContent}" />
			</tr>
			<tr>
				<th>작성일자</th>
				<td>[[${#dates.format(board.writeDate, 'yyyy.MM.dd')}]]</td>
			</tr>
			<tr>
				<th>조회수</th>
				<td>[[${board.viewCnt}]]</td>
			</tr>
		</table>
		<div>
			<button type="button" th:onclick="|location.href='@{freeboardUpdate(boardNo=${board.boardNo})}'|">수정</button>
			<button type="button" th:onclick="|location.href='@{freeboardList}'|">목록</button>
			<button type="button" id="deleteButton" data-url="#" th:data-url="@{/group/freeboardDelete(boardNo=${board.boardNo})}">삭제</button>
		</div>
	</div>
	
	  <!-- 댓글 영역 시작 -->
<div class="comments-section">
    <h4>댓글</h4>
    <ul class="comments-list" th:each="reply : ${comments}">
        <li class="comment-item">
            <div class="comment-author">
                <strong>작성자:</strong> [[${reply.commentWrite}]]
                <span>&#91;[[${reply.departmentName}]]&#93;</span>
                <span>&#91;[[${reply.rankName}]]&#93;</span>
            </div>
            <div class="comment-content">
                <strong>내용:</strong> [[${reply.commentContent}]]
            </div>
            <div class="comment-date">
                <strong>작성일:</strong> [[${#dates.format(reply.commentDate, 'yyyy.MM.dd')}]]
            </div>
        </li>
    </ul>
</div>

   <!-- 댓글 입력 폼 -->
<div class="comment-container">
    <h3>댓글 입력</h3>
    <form id="replyForm" action="/freeboardInfo" method="POST">
    	<input type="hidden" name="commentNo" id="commentNo" />
        <textarea name="commentContent" id="commentContent" placeholder="댓글을 입력하세요" required></textarea>
        <button type="submit">댓글 등록</button>
    </form>
</div>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
	<script>	
	// 글 삭제 버튼
	document.getElementById("deleteButton").addEventListener("click", function(event) {
	    event.preventDefault(); // 기본 동작 방지

	    Swal.fire({
	        title: '정말 삭제하시겠습니까?',
	        icon: 'warning',
	        showCancelButton: true,
	        confirmButtonColor: '#3085d6',
	        cancelButtonColor: '#d33',
	        confirmButtonText: '삭제',
	        cancelButtonText: '취소'
	    }).then((result) => {
	        if (result.isConfirmed) {
	            var deleteUrl = this.getAttribute('data-url');
	            window.location.href = deleteUrl; // 삭제 후 페이지 리다이렉트
	        }
	    });
	});
	
	$(document).ready(function() {
	    $('#replyForm').on('submit', function(event) {
	        event.preventDefault(); // 기본 폼 제출 동작 방지

	        // 폼 데이터 수집
	        var formData = {
	            commentNo: $('#commentNo').val(),
	            commentContent: $('#commentContent').val()
	        };

	        $.ajax({
	            url: '/replyInsert', // 서버 요청 URL
	            type: 'POST', // 요청 방법
	            data: formData, // 폼 데이터
	            success: function(response) {
	                // 성공적으로 응답을 받았을 때 처리
	                alert('댓글이 성공적으로 등록되었습니다!');
	                // 추가로 페이지를 새로고침하거나, 폼을 초기화하는 등의 처리를 할 수 있습니다.
	                $('#replyForm')[0].reset(); // 폼 초기화
	            },
	            error: function(xhr, status, error) {
	                // 요청 실패 시 처리
	                alert('댓글 등록 중 오류가 발생했습니다: ' + error);
	            }
	        });
	    });
	});
	
	
	</script>
</body>
</html>

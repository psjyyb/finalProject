<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.arion.app.home.pay.mapper.PayMapper">
	
	<select id="findLastNo" resultType="int">
		SELECT MAX(contract_no)+1
		FROM contract
	</select>
	<insert id="insertContract" statementType="CALLABLE" parameterType="ContractVO">
		 CALL contract_procedure(
		 						  #{companyCode}
		 						 ,#{contractNo}
		 						 ,#{finalDate}
		 						 ,#{usersCnt}
		 						 ,#{monthPayPrice}
		 						 ,#{totalPayPrice}
		 						 ,#{regularDate}
		 						 ,#{contractSign}
		 						 ,#{customerkey}
		 						 ,#{pCheck, mode=OUT, jdbcType=INTEGER})
	</insert>
	<insert id="insertSubModule" parameterType="ContractVO">
		INSERT INTO usemodule(
                         sub_module_no
                        ,module_no
                        ,module_price
                        ,module_name
                        ,company_code
                        ,contract_no
                       )
		VALUES(
		        (SELECT MAX(sub_module_no)+1
		         FROM usemodule)
		       ,(SELECT module_no
		         FROM module
		         WHERE module_name = #{moduleName}
		         )
		       ,(SELECT module_price
		         FROM module
		         WHERE module_name = #{moduleName}
		         )
		       ,#{moduleName}
		       ,#{companyCode}
		       ,#{contractNo}
		       )
		       
	</insert>
</mapper>
<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{common/group/layouts/group_layout}"
	layout:fragment="Content">
<head>
<meta charset="UTF-8">
<title></title>
<link rel="stylesheet" th:href="@{/smarteditor2/css/smart_editor2_items.css}">
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
</head>
<body>
	<div>
		<h3><a th:href="@{/group/freeboardList}">자유게시판</a></h3>
		
		<table>
			<tr>
				<th>번호</th>
				<td th:text="${board.boardNo}"></td>
			</tr>
			<tr>
				<th>제목</th>
				<td>[[${board.boardTitle}]]</td>
			</tr>
			<tr>
				<th>작성자</th>
				<td>[[${board.employeeName}]]</td>
			</tr>
			<tr>
				<th>내용</th>
				<td style="height:300px; width:500px;" th:utext="${board.boardContent}"></td>
			</tr>
			<tr>
				<th>작성일자</th>
				<td>[[${#dates.format(board.writeDate, 'yyyy.MM.dd')}]]</td>
			</tr>
			<tr>
				<th>조회수</th>
				<td>[[${board.viewCnt}]]</td>
			</tr>
		</table>
		<div>
			<button type="button" th:onclick="|location.href='@{freeboardUpdate(boardNo=${board.boardNo})}'|">수정</button>
			<button type="button" th:onclick="|location.href='@{freeboardList}'|">목록</button>
			<button type="button" id="deleteButton" data-url="#" th:data-url="@{/group/freeboardDelete(boardNo=${board.boardNo})}">삭제</button>
		</div>
	</div>
	
	  <!-- 댓글 영역 시작 -->
    <div>
        <h4>댓글</h4>
        <ul>
            <li th:each="reply : ${replies}">
                <div>
                    <p><strong>작성자:</strong> [[${reply.commentWrite}]]</p>
                    <p><strong>내용:</strong> [[${reply.commentContent}]]</p>
                    <p><strong>작성일:</strong> [[${#dates.format(reply.commentDate, 'yyyy.MM.dd')}]]</p>
                    <div>
                        <button type="button" class="editComment" th:data-url="@{/group/commentUpdate(commentNo=${reply.commentNo})}">수정</button>
                        <button type="button" class="deleteComment" th:data-url="@{/group/commentDelete(commentNo=${reply.commentNo})}">삭제</button>
                    </div>
                </div>
            </li>
        </ul>
    </div>

   <!-- 댓글 입력 폼 -->
	<div>
    	<h4>댓글 입력</h4>
    	<form id="commentForm">
        	<input type="hidden" id="boardNo" name="boardNo" th:value="${board.boardNo}">
        	<textarea id="commentContent" name="commentContent" placeholder="댓글을 입력하세요"></textarea>
        	<button type="button" onclick="submitComment()">댓글 추가</button>
    	</form>
	</div>
    
	<script>	
	// 글 삭제 버튼
	document.getElementById("deleteButton").addEventListener("click", function(event) {
	    event.preventDefault(); // 기본 동작 방지

	    Swal.fire({
	        title: '정말 삭제하시겠습니까?',
	        icon: 'warning',
	        showCancelButton: true,
	        confirmButtonColor: '#3085d6',
	        cancelButtonColor: '#d33',
	        confirmButtonText: '삭제',
	        cancelButtonText: '취소'
	    }).then((result) => {
	        if (result.isConfirmed) {
	            var deleteUrl = this.getAttribute('data-url');
	            window.location.href = deleteUrl; // 삭제 후 페이지 리다이렉트
	        }
	    });
	});
	
	
	// 댓글 삭제
	 document.querySelectorAll(".deleteComment").forEach(button => {
	        button.addEventListener("click", function(event) {
	            event.preventDefault();
	            Swal.fire({
	                title: '댓글을 삭제하시겠습니까?',
	                icon: 'warning',
	                showCancelButton: true,
	                confirmButtonColor: '#3085d6',
	                cancelButtonColor: '#d33',
	                confirmButtonText: '삭제',
	                cancelButtonText: '취소'
	            }).then((result) => {
	                if (result.isConfirmed) {
	                    var deleteUrl = this.getAttribute('data-url');
	                    window.location.href = deleteUrl; // 댓글 삭제 후 페이지 리다이렉트
	                }
	            });
	        });
	    });

	    document.querySelectorAll(".editComment").forEach(button => {
	        button.addEventListener("click", function(event) {
	            event.preventDefault();
	            var editUrl = this.getAttribute('data-url');
	            // 수정 로직 추가 (별도의 팝업 또는 페이지로 이동하여 수정 가능)
	            window.location.href = editUrl;
	        });
	    });
	    
	    function submitComment() {
	        var boardNo = document.getElementById('boardNo').value;
	        var commentContent = document.getElementById('commentContent').value;
	        var commentWrite = '작성자'; // 필요에 따라 설정

	        var xhr = new XMLHttpRequest();
	        xhr.open('POST', '/group/commentInsert', true);
	        xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
	        xhr.onreadystatechange = function () {
	            if (xhr.readyState === XMLHttpRequest.DONE) {
	                if (xhr.status === 200) {
	                    alert('댓글이 추가되었습니다.');
	                    location.reload(); // 페이지 새로고침
	                } else {
	                    alert('댓글 추가에 실패했습니다.');
	                }
	            }
	        };
	        xhr.send('boardNo=' + boardNo + '&commentContent=' + encodeURIComponent(commentContent) + '&commentWrite=' + commentWrite);
	    }
	</script>
</body>
</html>
<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
    xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
    layout:decorate="~{common/group/layouts/group_layout}"
    layout:fragment="Content">
<head>
<meta charset="UTF-8">
<title>ARION</title>
<script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.15/index.global.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/moment.min.js"></script>
<style>
  /* 부모 컨테이너 */
  .container {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    margin: 20px;
  }

  #calendar {
    max-width: 700px;
    max-height: 600px;
    flex-grow: 1;
  }

  #eventForm {
    width: 350px; /* 폼의 너비를 더 크게 설정 */
    max-height: 600px;
    margin-left: 20px;
    padding: 20px;
    border: 1px solid #ddd;
    border-radius: 5px;
    background-color: #f9f9f9;
    display: none; /* 초기에는 숨김 처리 */
  }

  #eventForm h2 {
    font-size: 18px;
    margin-bottom: 15px;
  }

  #eventForm label {
    display: block;
    margin: 10px 0 5px;
  }

  #eventForm input, #eventForm button {
    width: 100%;
    padding: 8px;
    margin-bottom: 10px;
  }

  #eventForm button {
    background-color: #007bff;
    border: none;
    color: white;
    cursor: pointer;
  }

  #eventForm button:hover {
    background-color: #0056b3;
  }

  /* 버튼 섹션 */
  .toggle-btns {
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    margin-top: 20px;
  }

  .toggle-btns button {
    padding: 10px 15px;
    margin-bottom: 10px;
    cursor: pointer;
    background-color: #007bff;
    color: white;
    border: none;
    border-radius: 3px;
  }

  .toggle-btns button:hover {
    background-color: #0056b3;
  }
</style>
</head>
<body>

  <div class="container">
    <div id="calendar"></div>

    <div class="toggle-btns">
      <button id="toggleFormBtn">등록 폼 보이기/숨기기</button>
    </div>

    <div id="eventForm">
      <h2>이벤트 세부사항</h2>
      <form>
        <label for="eventTitle">이벤트 제목:</label>
        <input type="text" id="eventTitle" placeholder="이벤트 제목 입력">
        
        <label for="startDate">시작 날짜 및 시간:</label>
        <input type="text" id="startDate" placeholder="yyyy-MM-dd HH:mm">
        
        <label for="endDate">종료 날짜 및 시간:</label>
        <input type="text" id="endDate" placeholder="yyyy-MM-dd HH:mm">
        
        <button type="button" id="addEventBtn">이벤트 추가</button>
        <button type="button" id="updateEventBtn">이벤트 수정</button>
        <button type="button" id="deleteEventBtn">이벤트 삭제</button>
      </form>
    </div>
  </div>

<script>
  $(document).ready(function() {
    var calendarEl = $('#calendar');
    var eventTitleInput = $('#eventTitle');
    var startDateInput = $('#startDate');
    var endDateInput = $('#endDate');
    var selectedEvent = null;
    var toggleFormBtn = $('#toggleFormBtn');
    var eventForm = $('#eventForm');

    var calendar = new FullCalendar.Calendar(calendarEl[0], {
      initialDate: '2023-01-12',
      initialView: 'dayGridMonth',
      nowIndicator: true,
      headerToolbar: {
        left: 'prev,next today',
        center: 'title',
        right: 'dayGridMonth,timeGridWeek,timeGridDay,listWeek'
      },
      navLinks: true, // 클릭하여 날짜/주 선택 가능
      editable: true,
      selectable: true,
      selectMirror: true,
      dayMaxEvents: true, // 너무 많은 이벤트가 있을 경우 "더 보기" 링크 허용
      events: [
        {
          title: '하루 종일 이벤트',
          start: '2023-01-01',
        },
        {
          title: '긴 이벤트',
          start: '2023-01-07',
          end: '2023-01-10'
        },
        {
          groupId: 999,
          title: '반복 이벤트',
          start: '2023-01-09T16:00:00'
        },
        {
          groupId: 999,
          title: '반복 이벤트',
          start: '2023-01-16T16:00:00'
        },
        {
          title: '컨퍼런스',
          start: '2023-01-11',
          end: '2023-01-13'
        },
        {
          title: '회의',
          start: '2023-01-12T10:30:00',
          end: '2023-01-12T12:30:00'
        },
        {
          title: '점심',
          start: '2023-01-12T12:00:00'
        },
        {
          title: '회의',
          start: '2023-01-12T14:30:00'
        },
        {
          title: '해피 아워',
          start: '2023-01-12T17:30:00'
        },
        {
          title: '저녁',
          start: '2023-01-12T20:00:00'
        },
        {
          title: '생일 파티',
          start: '2023-01-13T07:00:00'
        },
        {
          title: '구글로 이동',
          url: 'http://google.com/',
          start: '2023-01-28'
        }
      ],
      dateClick: function(info) {
        startDateInput.val(moment(info.date).format('YYYY-MM-DD HH:mm'));
        endDateInput.val("");
        eventTitleInput.val("");
        selectedEvent = null;
        toggleFormBtn.hide(); // 버튼 숨기기
        eventForm.show(); // 날짜 클릭 시 폼 표시
      },
      eventClick: function(info) {
        selectedEvent = info.event;
        eventTitleInput.val(selectedEvent.title);
        startDateInput.val(moment(selectedEvent.start).format('YYYY-MM-DD HH:mm'));
        endDateInput.val(selectedEvent.end ? moment(selectedEvent.end).format('YYYY-MM-DD HH:mm') : ""); // 종료 날짜가 있을 경우에만 설정
        toggleFormBtn.hide(); // 버튼 숨기기
        eventForm.show(); // 이벤트 클릭 시 폼 표시
      }
    });

    calendar.render();

    $('#addEventBtn').on('click', function() {
    	let content=eventTitleInput.val();
    	let startDate = moment(startDateInput.val(), 'YYYY-MM-DD HH:mm').toISOString();
    	let finalDate = endDateInput.val() ? moment(endDateInput.val(), 'YYYY-MM-DD HH:mm').toISOString() : null;
      if (eventTitleInput.val()) {
        calendar.addEvent({
          title: content ,
          start:startDate,
          end: finalDate,
          allDay: false
        });
         $.ajax({
		url:'/group/schedule/empCalcInsert',
		method:'POST',
		data:{scheduleTitle:content,
			  scheduleStarts:startDate,
			  scheduleEnds:finalDate}
         ,success:(result)=>{
        	 console.log(result);
         },
         error:(err)=>{
        	 console.log(err);
         }
		}) 
        eventForm.hide();
        toggleFormBtn.show(); // 버튼 다시 보이기
      }
    });

    $('#updateEventBtn').on('click', function() {
      if (selectedEvent && eventTitleInput.val()) {
        selectedEvent.setProp('title', eventTitleInput.val());
        selectedEvent.setStart(moment(startDateInput.val(), 'YYYY-MM-DD HH:mm').toISOString());
        selectedEvent.setEnd(endDateInput.val() ? moment(endDateInput.val(), 'YYYY-MM-DD HH:mm').toISOString() : null);
        eventForm.hide();
        toggleFormBtn.show(); // 버튼 다시 보이기
      }
    });

    $('#deleteEventBtn').on('click', function() {
      if (selectedEvent) {
        selectedEvent.remove();
        selectedEvent = null;
        eventTitleInput.val("");
        startDateInput.val("");
        endDateInput.val("");
        eventForm.hide();
        toggleFormBtn.show(); // 버튼 다시 보이기
      }
    });

    // 폼 토글 버튼 클릭 시 폼의 표시/숨기기 처리
    toggleFormBtn.on('click', function() {
      eventForm.toggle();
      if (eventForm.is(':visible')) {
        toggleFormBtn.hide(); // 폼이 보일 때 버튼 숨기기
      } else {
        toggleFormBtn.show(); // 폼이 숨겨질 때 버튼 보이기
      }
    });
  });
</script>
</body>
</html>

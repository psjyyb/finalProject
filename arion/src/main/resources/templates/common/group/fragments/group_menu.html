<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Group Menu</title>
    <link rel="stylesheet" th:href="@{/vendor/bootstrap/css/bootstrap.min.css}">
    <link rel="stylesheet" th:href="@{/vendor/fontawesome-free/css/all.min.css}">
    <style>
        .collapse {
            display: none;
        }
    </style>
</head>
<body id="page-top">
    <th:block th:fragment="GroupMenuFragment">
        <ul class="navbar-nav bg-gradient-primary sidebar sidebar-dark accordion" id="accordionSidebar">
            <!-- Sidebar - Brand -->
            <a class="sidebar-brand d-flex align-items-center justify-content-center" href="index.html">
                <div class="sidebar-brand-icon rotate-n-15">
                    <i class="fas fa-laugh-wink"></i>
                </div>
                <div class="sidebar-brand-text mx-3">
                    Arion <sup></sup>
                </div>
            </a>

            <!-- Divider -->
            <hr class="sidebar-divider my-0">

            <!-- Sidebar items -->
            <li class="nav-item" th:each="module : ${modules}">
                <a class="nav-link collapsed" href="javascript:void(0);" 
                   data-toggle="collapse" 
                   data-target="#collapse${module.moduleNo}" 
                   aria-expanded="false" 
                   aria-controls="collapse${module.moduleNo}"
                   data-module-no="${module.moduleNo}">
                    <i class="fas fa-fw fa-cogs"></i>
                    <span th:text="${module.moduleName}"></span>
                </a>
                <div id="collapse${module.moduleNo}" class="collapse">
                    <div class="bg-white py-2 collapse-inner rounded">
                        <h6 class="collapse-header">Submodules:</h6>
                        <!-- Dynamic Submodules -->
                        <ul class="nav flex-column submodules-list">
                            <!-- Submodules will be dynamically inserted here -->
                        </ul>
                    </div>
                </div>
            </li>

            <!-- Divider -->
            <hr class="sidebar-divider">

            <!-- Heading -->
            <div class="sidebar-heading">Interface</div>
        </ul>
    </th:block>
    
    <!-- Scripts -->
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <script>
        $(document).ready(function() {
            $('.nav-link.collapsed').on('click', function() {
                var moduleNo = $(this).data('module-no');
                var targetCollapse = $(this).attr('data-target');
                
                // Toggle collapse
                $(targetCollapse).collapse('toggle');

                // Fetch submodules if not already fetched
                var submoduleList = $(targetCollapse).find('.submodules-list');
                if (submoduleList.children().length === 0) {
                    $.ajax({
                        url: '/api/submodules/' + moduleNo, // Adjust the URL according to your API
                        method: 'GET',
                        success: function(subModules) {
                            submoduleList.empty();
                            subModules.forEach(function(subModule) {
                                var listItem = $('<li class="nav-item"></li>');
                                var link = $('<a class="nav-link"></a>')
                                    .attr('href', subModule.url)
                                    .text(subModule.subModuleName);
                                listItem.append(link);
                                submoduleList.append(listItem);
                            });
                        },
                        error: function() {
                            console.error('Failed to load submodules');
                        }
                    });
                }
            });
        });
    </script>
</body>
</html>

<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.arion.app.home.pay.mapper.PayMapper">
	
	<select id="findLastNo" resultType="int">
		SELECT MAX(contract_no)+1
		FROM contract
	</select>
<!-- 	<select id="insertContract" statementType="CALLABLE" parameterType="ContractVO">
		 CALL contract_procedure(
		 						  #{companyCode, mode=IN, jdbcType=VARCHAR}
		 						 ,#{contractNo, mode=IN, jdbcType=INTEGER}
		 						 ,#{finalDate, mode=IN, jdbcType=DATE}
		 						 ,#{usersCnt, mode=IN, jdbcType=INTEGER}
		 						 ,#{monthPayPrice, mode=IN, jdbcType=INTEGER}
		 						 ,#{totalPayPrice, mode=IN, jdbcType=INTEGER}
		 						 ,#{regularDate, mode=IN, jdbcType=INTEGER}
		 						 ,#{contractSign, mode=IN, jdbcType=VARCHAR}
		 						 ,#{customerkey, mode=IN, jdbcType=VARCHAR}
		 						 ,#{firstMonthAmount, mode=IN, jdbcType=INTEGER}
		 						 ,#{checks, mode=OUT, jdbcType=INTEGER})
	</select> -->
	<insert id="insertContract">
		 INSERT INTO contract(
                              contract_no
                             ,final_date
                             ,users_cnt
                             ,month_pay_price
                             ,total_pay_price
                             ,regular_date
                             ,contract_state
                             ,company_code
                             ,contract_sign)
        VALUES(
               #{contractNo}
              ,#{finalDate}
              ,#{usersCnt}
              ,#{monthPayPrice}
              ,#{totalPayPrice}
              ,#{regularDate}
              ,'계약중'
              ,#{companyCode}
              ,#{contractSign}
              )
	</insert>
	<insert id="insertSubModule" parameterType="ContractVO">
		INSERT INTO usemodule(
                         sub_module_no
                        ,module_no
                        ,module_price
                        ,module_name
                        ,company_code
                        ,contract_no
                       )
		VALUES(
		        (SELECT MAX(sub_module_no)+1
		         FROM usemodule)
		       ,(SELECT module_no
		         FROM module
		         WHERE module_name = #{moduleName}
		         )
		       ,(SELECT module_price
		         FROM module
		         WHERE module_name = #{moduleName}
		         )
		       ,#{moduleName}
		       ,#{companyCode}
		       ,#{contractNo}
		       )
	</insert>
	<select id="selectComInfo">
		SELECT company_code
		      ,company_name
		      ,company_tel
		      ,company_id
		      ,company_business_number
		      ,company_type
		      ,company_address
		      ,company_post
		      ,ceo_name
		      ,ceo_email
		      ,ceo_phone
		      ,site_resp
		FROM company 
		WHERE company_code = #{companyCode}
	
	</select>
</mapper>